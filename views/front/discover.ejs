<% layout('layouts/main') %>

<h1 class="text-xl font-semibold mb-3">Discover Movies</h1>

<div class="glass-card rounded-xl p-4 mb-3">
  <form method="get" action="/discover" class="flex flex-wrap gap-2 items-center text-[11px]">
    <div class="flex-1">
      <span class="text-slate-400 mr-1">Genre:</span>
      <select name="genre" class="input-base text-xs w-[200px]">
        <option value="">All genres</option>
        <% genres.genres.forEach(g => { %>
          <option value="<%= g.id %>" <%= String(activeGenre) === String(g.id) ? 'selected' : '' %>>
            <%= g.name %>
          </option>
        <% }) %>
      </select>
    </div>
    <div>
      <span class="text-slate-400 mr-1">Page:</span>
      <input type="number" min="1" name="page" value="<%= page %>" class="input-base text-xs w-20" />
    </div>
    <button class="px-3 py-1 rounded bg-indigo-500 hover:bg-indigo-600 text-[11px]">
      Apply
    </button>
  </form>
</div>

<div class="glass-card rounded-xl p-4">
  <% if (!discover || !discover.results || !discover.results.length) { %>
    <div class="text-xs text-slate-400">
      Tidak ada hasil.
    </div>
  <% } else { %>
    <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2">
      <% discover.results.forEach(m => { %>
        <a href="/movie/<%= m.id %>" class="group text-[11px]">
          <div class="rounded-md overflow-hidden bg-slate-900 border border-slate-800 aspect-[2/3] mb-1">
            <% if (m.poster_path) { %>
              <img src="https://image.tmdb.org/t/p/w185<%= m.poster_path %>"
                   class="w-full h-full object-cover group-hover:scale-105 transition" />
            <% } else { %>
              <div class="w-full h-full flex items-center justify-center text-[10px] text-slate-500">
                No image
              </div>
            <% } %>
          </div>
          <div class="truncate font-medium"><%= m.title %></div>
          <div class="text-[10px] text-slate-400">
            <%= (m.release_date || '').slice(0,4) %> · ★ <%= (m.vote_average || 0).toFixed(1) %>
          </div>
        </a>
      <% }) %>
    </div>

    <div class="mt-3 flex justify-between text-[11px] text-slate-400">
      <div>Page <%= discover.page %> of <%= discover.total_pages %></div>
      <div class="space-x-2">
        <% if (discover.page > 1) { %>
          <a href="/discover?genre=<%= activeGenre %>&page=<%= discover.page - 1 %>"
             class="underline">Prev</a>
        <% } %>
        <% if (discover.page < discover.total_pages) { %>
          <a href="/discover?genre=<%= activeGenre %>&page=<%= discover.page + 1 %>"
             class="underline">Next</a>
        <% } %>
      </div>
    </div>
  <% } %>
</div>
